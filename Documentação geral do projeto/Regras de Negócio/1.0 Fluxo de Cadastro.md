# 📌 Regras de Negócio – Fluxo de Cadastro ConectaBem

> Sistema: ConectaBem

> Versão: 1.0

> Relacionado: [Fluxo de Cadastro](https://www.figma.com/design/NtXWClFNNGscXzSd38vwmX/Squad-Design_ConectaBem_v.28.07.25?node-id=8462-94204)

---


## 1. Cadastro via Provedores (Google / Facebook)

- O sistema deve permitir autenticação apenas através de contas válidas do Google ou Facebook.
- O sistema deve validar a permissão do usuário para compartilhar os dados básicos (nome, e-mail).
- Se o usuário não conceder permissão, o cadastro não poderá ser concluído.
- Após autenticação bem-sucedida, o usuário deve obrigatoriamente selecionar o perfil (“Paciente” ou “Médico”) antes de prosseguir.
- Um Pop over explicativo de perfis deve estar no primeiro momento em que o usuário vai fazer a escolha do tipo de perfil.

---

## 2. Cadastro via E-mail

- O sistema deve validar o formato do e-mail antes de permitir a continuação do cadastro.

### 2.1 Validade do Código

- O sistema deve enviar um código de validação ao e-mail informado.
- Será mostrada uma mensagem com o tempo máximo de validade do código de verificação.
  - Deverá ser exibida em contagem regressiva de segundos.
- Cada novo código gerado deve invalidar o anterior.
- A contagem de expiração (tempo recomendado entre 30 segundos e 5 minutos – conforme [artigo](https://arkesel.com/securing-transactions-with-otp-apis-10-best-practices/?utm_source=chatgpt.com)) deve reiniciar a cada reenvio.
- Título e texto da página devem fornecer feedback para o usuário de que um novo código foi enviado e o antigo invalidado.
- O botão de reenviar código deve estar disponível pela primeira vez após 60 segundos.
- Durante a validação do código fornecido, o link de reenviar e o botão de validar devem ficar desabilitados. O CTA deve exibir a mensagem **"Validando"**.
- O reenvio do código tem o limite de **5 tentativas por hora**.
- Caso exista um erro, a mensagem de erro é aplicada ao bloco inteiro, mudando de cor (texto e inputs em vermelho).
  - Inputs vazios → "Preencha todos os campos para continuar".
  - Código incorreto → "Preencha corretamente ou reenvie o código e tente novamente".
- O cadastro só poderá prosseguir após a validação correta do código.
- Caso o código seja inválido ou expirado, o sistema deve solicitar novo envio.
- Se atingir o limite de 5 códigos inválidos, apenas será possível gerar um novo após 1 hora.
- Ao atingir o limite, exibir mensagem em vermelho: **"Você só poderá solicitar novamente o código após 1 hora"**.

---

## 3. Dados Obrigatórios

- O sistema deve exigir o preenchimento de todos os campos obrigatórios (ex.: nome completo, data de nascimento, gênero, cidade, CEP).
- Ao inserir o CEP, o sistema deverá efetuar a validação do CEP digitado.
- Ao clicar no link "Busca CEP", a página exibida deverá ser a página de busca de CEP dos Correios.
- Usuários do perfil **Paciente** devem preencher também preferências de atendimento e acessibilidade.
- Usuários do perfil **Profissional** devem preencher especialidades, registro profissional e disponibilidade.
- Em caso de dados não preenchidos ou incorretos, o label e a caixa ficam vermelhos, com texto de apoio abaixo.
- O cadastro não pode ser concluído se algum campo obrigatório estiver em branco.

---

## 3.1 Validações Detalhadas

### 3.1.1 📋 Validações do formulário (Paciente)

## 👤 Nome
- Mínimo 3 caracteres.
- Pode conter espaços, mas apenas **um espaço entre palavras**.

## 🎂 Data de Nascimento
- Não pode ser mais antiga que 110 anos atrás.
- Usuário deve ter **mínimo de 18 anos** para se cadastrar.

## 🏠 CEP Residencial
- Exatamente 9 caracteres no formato `00000-000`.
- Valida via **ViaCEP** → se não existir, retorna "CEP não encontrado".

## 📌 Endereço Residencial
- Mínimo 3 caracteres.
 
## 🏙️ Bairro Residencial
- Mínimo 3 caracteres.

## 🌆 Cidade Residencial
- Mínimo 3 caracteres.

## 🗺️ Estado Residencial
- Mínimo 3 caracteres.

## ♿ Accessibilidade
- Aceita uma lista (array) de opções em texto.
   - Exemplo: `["rampa", "banheiro adaptado"]`.
- Pode ser vazio ou conter múltiplos itens.

## 🩺 Especialidades
- Pelo menos **1 especialidade selecionada**.
- Aceita lista (array) de opções em texto.

## ⚙️ Preferências 
- Aceita lista (array) de opções em texto.
- Pode ser vazio ou conter múltiplos itens.


---

### 3.1.2 📋 Validações do formulário (Profissional)

## 👤 Nome
- Mínimo 10 caracteres.
- Apenas letras (com acentos).
- Apenas 1 espaço entre palavras.

## 🎂 Data de Nascimento
- Não pode ser mais antiga que 110 anos atrás.
- Usuário deve ter **mínimo de 18 anos**.

## 🏠 CEP Residencial
- Exatamente 9 caracteres no formato `00000-000`.
- Valida via **ViaCEP** → se não existir, retorna "CEP não encontrado".

## 📌 Endereço Residencial
- Mínimo 3 caracteres.

## 🏙️ Bairro Residencial
- Mínimo 3 caracteres.

## 🌆 Cidade Residencial
- Mínimo 3 caracteres.

## 🗺️ Estado Residencial
- Mínimo 3 caracteres.

## 🏥 Nome da Clínica
- Mínimo 3 caracteres.

## 🆔 CPF / CNPJ
- Entre 11 e 18 caracteres.
- Deve validar se é **CPF ou CNPJ real**.
- Mensagem de erro: **"CNPJ ou CPF inválido"**.

## 🏠 CEP Profissional
- Exatamente 9 caracteres no formato `00000-000`.
- Valida via **ViaCEP** → retorna "CEP não encontrado" se inválido.

## 📌 Endereço da Clínica
- Mínimo 5 caracteres.

## 🏙️ Bairro da Clínica
- Mínimo 3 caracteres.

## 🔢 Número da Clínica
- Deve ser **número ≥ 1**.

## 📝 Complemento da Clínica
- Campo opcional (string livre).

## 🌆 Cidade da Clínica
- Mínimo 3 caracteres.

## 🗺️ Estado da Clínica
- Mínimo 3 caracteres.

## 🩺 Especialidades
- Pelo menos **1 especialidade selecionada**.
- Aceita lista (array) de opções em texto.

**⚙️ Service Preferences**
- Aceita lista (array) de opções em texto.
- Campo pode ser **nulo (null)** ou conter múltiplos itens.

## 💡 Suggestions
- Pelo menos 1 caractere.
- Mensagem de erro: **"Sugestão inválida"** se vazio.

---

## 4. Fluxo de Conclusão

- O cadastro só será considerado concluído quando todos os dados obrigatórios forem validados.
- Após a conclusão, o usuário deve ser automaticamente redirecionado para a Home autenticado.
- O sistema deve registrar a data e hora da criação do cadastro.
- Se o usuário já tiver conta, ele será redirecionado para a Home após logar com e-mail ou Google/Facebook.

---

## 5. Restrições e Validações Gerais

- Não é permitido cadastrar o mesmo e-mail mais de uma vez.
- Perfis diferentes (Paciente e Profissional) não podem compartilhar o mesmo e-mail.
- O sistema deve exibir mensagens claras em caso de erro (ex.: e-mail já cadastrado, código inválido, falta de conexão).
- Em caso de falha de conexão durante o cadastro, o processo deve ser interrompido e o usuário informado para tentar novamente.

